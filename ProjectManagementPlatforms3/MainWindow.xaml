<Window x:Class="ProjectManagementPlatform.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Управление проектами" Height="750" Width="1100"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Стили для статусов задач -->
        <Style x:Key="TaskStatusStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Style.Triggers>
                <Trigger Property="Text" Value="Выполнена">
                    <Setter Property="Foreground" Value="Green"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Trigger>
                <Trigger Property="Text" Value="В работе">
                    <Setter Property="Foreground" Value="Blue"/>
                </Trigger>
                <Trigger Property="Text" Value="На проверке">
                    <Setter Property="Foreground" Value="Orange"/>
                </Trigger>
                <Trigger Property="Text" Value="К выполнению">
                    <Setter Property="Foreground" Value="Gray"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="350"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель: Управление проектами -->
        <Grid Grid.Column="0" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="Проекты" FontSize="16" FontWeight="Bold"/>
                <Button Content="+" Command="{Binding AddProjectCommand}" 
                        ToolTip="Добавить проект" Margin="10,0,0,0" Width="30"
                        Background="LightGreen"/>
            </StackPanel>

            <ListView Grid.Row="1" ItemsSource="{Binding Projects}" 
                     SelectedItem="{Binding SelectedProject}" 
                     DisplayMemberPath="Name"
                     Margin="0,0,0,10"/>

            <!-- Форма редактирования проекта -->
            <GroupBox Grid.Row="2" Header="Редактирование проекта">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Название проекта:" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding SelectedProject.Name, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,5"/>

                        <TextBlock Text="Описание:" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding SelectedProject.Description, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="60" AcceptsReturn="True" TextWrapping="Wrap"
                                 Margin="0,0,0,5"/>

                        <Grid Margin="0,5,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                <TextBlock Text="Срок:" Margin="0,0,0,5"/>
                                <DatePicker SelectedDate="{Binding SelectedProject.Deadline}"
                                           Margin="0,0,0,5"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Бюджет:" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding SelectedProject.Budget, StringFormat=N0}"
                                         Margin="0,0,0,5"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="Статус проекта:" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding SelectedProject.Status}" 
                                  Margin="0,0,0,10">
                            <ComboBoxItem>Planning</ComboBoxItem>
                            <ComboBoxItem>InProgress</ComboBoxItem>
                            <ComboBoxItem>Completed</ComboBoxItem>
                            <ComboBoxItem>OnHold</ComboBoxItem>
                        </ComboBox>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Content="Сохранить" Command="{Binding SaveProjectCommand}" 
                                    Width="100" Margin="0,0,10,0" Background="LightBlue"/>
                            <Button Content="Удалить" Command="{Binding DeleteProjectCommand}" 
                                    Width="100" Background="LightCoral"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>
        </Grid>

        <!-- Центральная панель: Задачи проекта -->
        <Grid Grid.Column="1" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Text="Задачи проекта" 
                      FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>

            <ListView Grid.Row="1" ItemsSource="{Binding ProjectTasks}" 
                     SelectedItem="{Binding SelectedTask}"
                     ScrollViewer.VerticalScrollBarVisibility="Auto">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Задача" Width="150">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Title}" TextWrapping="Wrap" Width="130"/>
                                    </StackPanel>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Исполнитель" DisplayMemberBinding="{Binding AssignedTo}" Width="100"/>
                        <GridViewColumn Header="Срок" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DueDate, StringFormat=dd.MM.yyyy}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Приоритет" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayPriority}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Priority}" Value="High">
                                                        <Setter Property="Foreground" Value="Red"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Priority}" Value="Medium">
                                                        <Setter Property="Foreground" Value="Orange"/>
                                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Priority}" Value="Low">
                                                        <Setter Property="Foreground" Value="Green"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Статус" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayStatus}" Style="{StaticResource TaskStatusStyle}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Часы" Width="60">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding EstimatedHours}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>

        <!-- Правая панель: Управление задачами -->
        <Grid Grid.Column="2" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Форма управления задачей -->
            <GroupBox Grid.Row="0" Header="Управление задачей" Margin="0,0,0,10">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Название задачи:"/>
                        <TextBox Text="{Binding NewTaskTitle, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,5"/>

                        <TextBlock Text="Описание:"/>
                        <TextBox Text="{Binding NewTaskDescription, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="60" AcceptsReturn="True" TextWrapping="Wrap"
                                 Margin="0,0,0,5"/>

                        <Grid Margin="0,5,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                <TextBlock Text="Исполнитель:"/>
                                <ComboBox ItemsSource="{Binding AvailableAssignees}" 
                                         SelectedItem="{Binding SelectedAssignee}"
                                         Height="25"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Приоритет:"/>
                                <ComboBox ItemsSource="{Binding AvailablePriorities}" 
                                         SelectedItem="{Binding SelectedPriority}"
                                         Height="25"/>
                            </StackPanel>
                        </Grid>

                        <!-- ДОБАВЛЕНО: Поле для оценки часов -->
                        <Grid Margin="0,5,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Оценка часов:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" Text="{Binding EstimatedHours, StringFormat=N1}"
                                     Width="80" HorizontalAlignment="Left"/>
                        </Grid>

                        <!-- Статус задачи -->
                        <TextBlock Text="Статус задачи:" Margin="0,10,0,5"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                            <Button Content="К выполнению" Command="{Binding ChangeTaskStatusCommand}" 
                                    CommandParameter="ToDo" Width="100" Margin="0,0,5,0"
                                    Background="#E0E0E0"/>
                            <Button Content="В работу" Command="{Binding ChangeTaskStatusCommand}" 
                                    CommandParameter="InProgress" Width="90" Margin="0,0,5,0"
                                    Background="#87CEEB"/>
                            <Button Content="На проверку" Command="{Binding ChangeTaskStatusCommand}" 
                                    CommandParameter="Review" Width="100"
                                    Background="#FFD700"/>
                        </StackPanel>

                        <Grid Margin="0,5,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0" Content="Добавить" Command="{Binding AddTaskCommand}" 
                                    Margin="0,0,5,0" Background="LightGreen"/>
                            <Button Grid.Column="1" Content="Сохранить" Command="{Binding SaveTaskCommand}" 
                                    Background="LightBlue"/>
                        </Grid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Content="Выполнена" Command="{Binding MarkTaskCompleteCommand}" 
                                    Width="90" Margin="0,0,10,0" Background="LightGreen"/>
                            <Button Content="Очистить" Command="{Binding ClearTaskFormCommand}" 
                                    Width="80" Margin="0,0,10,0"/>
                            <Button Content="Удалить" Command="{Binding DeleteTaskCommand}" 
                                    Width="80" Background="LightCoral"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>

            <!-- Информация о выбранной задаче -->
            <GroupBox Grid.Row="1" Header="Информация о задаче">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Безопасное отображение названия задачи -->
                        <TextBlock Text="{Binding SelectedTaskTitle}" 
                                   FontSize="14" FontWeight="Bold" Margin="0,0,0,10"
                                   TextWrapping="Wrap"/>

                        <!-- Статус задачи -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Статус:" FontWeight="Bold" Margin="0,0,5,0"/>
                            <TextBlock Grid.Column="1" Text="{Binding SelectedTaskStatus}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedTask.Status}" Value="Completed">
                                                <Setter Property="Foreground" Value="Green"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTask.Status}" Value="InProgress">
                                                <Setter Property="Foreground" Value="Blue"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTask.Status}" Value="Review">
                                                <Setter Property="Foreground" Value="Orange"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTask.Status}" Value="ToDo">
                                                <Setter Property="Foreground" Value="Gray"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                        <!-- Приоритет задачи -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Приоритет:" FontWeight="Bold" Margin="0,0,5,0"/>
                            <TextBlock Grid.Column="1" Text="{Binding SelectedTaskPriority}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedTask.Priority}" Value="High">
                                                <Setter Property="Foreground" Value="Red"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTask.Priority}" Value="Medium">
                                                <Setter Property="Foreground" Value="Orange"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTask.Priority}" Value="Low">
                                                <Setter Property="Foreground" Value="Green"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                        <!-- Исполнитель -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Исполнитель:" FontWeight="Bold" Margin="0,0,5,0"/>
                            <TextBlock Grid.Column="1" Text="{Binding SelectedTask.AssignedTo}"/>
                        </Grid>

                        <!-- Описание -->
                        <TextBlock Text="Описание:" FontWeight="Bold" Margin="0,10,0,5"/>
                        <TextBlock Text="{Binding SelectedTask.Description}" 
                                   TextWrapping="Wrap" Margin="0,0,0,10"
                                   Background="#F5F5F5" Padding="5"/>

                        <!-- Детали задачи -->
                        <Grid Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Срок:" FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedTask.DueDate, StringFormat=dd.MM.yyyy}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Оценка часов:" FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedTaskHours}"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="{Binding SelectedTask.CreatedAt, StringFormat='Создана: {0:dd.MM.yyyy HH:mm}'}" 
                                   Margin="0,10,0,0" FontStyle="Italic"/>
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>
        </Grid>
    </Grid>
</Window>